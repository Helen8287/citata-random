<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор случайных цитат</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .card {
            border-radius: 20px;
            border: none;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .quote-card {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            min-height: 300px;
            border-left: 6px solid #6a11cb;
        }

        .quote-text {
            font-size: 1.4rem;
            line-height: 1.6;
            color: #2c3e50;
            font-style: italic;
        }

        .quote-author {
            color: #6a11cb;
            font-weight: 600;
        }

        .quote-source {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .category-badge {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
        }

        .api-btn.active {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            border-color: #6a11cb;
        }

        .loading-spinner {
            display: none;
        }

        .fade-in {
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .heart {
            color: #e74c3c;
        }

        .footer-link {
            color: #6a11cb;
            text-decoration: none;
        }

        .footer-link:hover {
            text-decoration: underline;
        }

        /* Анимация для кнопки */
        .btn-primary {
            background: linear-gradient(to right, #6a11cb, #2575fc);
            border: none;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.4);
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- Заголовок -->
                <div class="text-center mb-5">
                    <h1 class="display-4 fw-bold text-white mb-3">
                        <i class="fas fa-quote-left"></i> Генератор цитат
                    </h1>
                    <p class="lead text-white-50">Получайте вдохновляющие цитаты из различных источников</p>
                </div>

                <!-- Карточка с цитатой -->
                <div class="card quote-card mb-4 fade-in" id="quoteCard">
                    <div class="card-body d-flex flex-column justify-content-center p-5">
                        <div class="text-center mb-4">
                            <i class="fas fa-quote-left fa-2x text-muted mb-3"></i>
                            <p class="quote-text" id="quoteText">
                                Нажмите кнопку ниже, чтобы получить случайную цитату
                            </p>
                        </div>

                        <div class="mt-4 text-end">
                            <p class="quote-author mb-1" id="quoteAuthor"></p>
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <div>
                                    <span class="badge category-badge rounded-pill" id="quoteCategory"></span>
                                    <small class="quote-source ms-2" id="quoteSource"></small>
                                </div>
                                <div class="tags" id="quoteTags"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Управление -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-3">
                            <i class="fas fa-sliders-h"></i> Настройки
                        </h5>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Источник цитат:</label>
                                <div class="btn-group w-100" role="group">
                                    <button type="button" class="btn btn-outline-primary api-btn active" data-source="api_ninjas">
                                        <i class="fas fa-user-ninja"></i> API Ninjas
                                    </button>
                                    <button type="button" class="btn btn-outline-primary api-btn" data-source="quoteslate">
                                        <i class="fas fa-scroll"></i> QuotesLate
                                    </button>
                                    <button type="button" class="btn btn-outline-primary api-btn" data-source="both">
                                        <i class="fas fa-random"></i> Оба источника
                                    </button>
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label">Действия:</label>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-primary flex-grow-1" id="newQuoteBtn">
                                        <i class="fas fa-sync-alt"></i> Новая цитата
                                    </button>
                                    <button class="btn btn-outline-secondary" id="copyQuoteBtn" title="Копировать цитату">
                                        <i class="far fa-copy"></i>
                                    </button>
                                    <button class="btn btn-outline-info" id="shareTwitterBtn" title="Поделиться в Twitter">
                                        <i class="fab fa-twitter"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Индикатор загрузки -->
                        <div class="text-center loading-spinner" id="loadingSpinner">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Загрузка...</span>
                            </div>
                            <p class="mt-2">Загружаем цитату...</p>
                        </div>
                    </div>
                </div>

                <!-- Информация об API -->
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-info-circle"></i> Информация
                        </h5>
                        <p>Это приложение получает случайные цитаты из двух публичных API:</p>
                        <ul>
                            <li><strong>API Ninjas</strong> - предоставляет цитаты известных людей с указанием автора и категории</li>
                            <li><strong>QuotesLate</strong> - открытый API с цитатами на английском языке</li>
                        </ul>
                        <p class="mb-0">
                            <small class="text-muted">
                                Примечание: Для работы API Ninjas требуется API ключ. Вы можете получить его бесплатно на
                                <a href="https://api-ninjas.com/api/quotes" target="_blank" class="footer-link">сайте API Ninjas</a>
                                и добавить в файл .env как <code>API_NINJAS_KEY=ваш_ключ</code>
                            </small>
                        </p>
                    </div>
                </div>

                <!-- Футер -->
                <footer class="text-center text-white mt-5">
                    <p>Создано с <i class="fas fa-heart heart"></i> для вдохновения</p>
                    <p class="small">© 2023 Генератор случайных цитат | Используются публичные API</p>
                </footer>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS и Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Элементы DOM
            const quoteCard = document.getElementById('quoteCard');
            const quoteText = document.getElementById('quoteText');
            const quoteAuthor = document.getElementById('quoteAuthor');
            const quoteCategory = document.getElementById('quoteCategory');
            const quoteSource = document.getElementById('quoteSource');
            const quoteTags = document.getElementById('quoteTags');
            const newQuoteBtn = document.getElementById('newQuoteBtn');
            const copyQuoteBtn = document.getElementById('copyQuoteBtn');
            const shareTwitterBtn = document.getElementById('shareTwitterBtn');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const apiButtons = document.querySelectorAll('.api-btn');

            // Переменные состояния
            let currentSource = 'api_ninjas';
            let currentQuote = '';
            let currentAuthor = '';

            // Функция для обновления активной кнопки API
            function updateActiveApiButton(source) {
                apiButtons.forEach(btn => {
                    if (btn.dataset.source === source) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }

            // Функция для получения цитаты
            async function fetchQuote(source = currentSource) {
                try {
                    // Показать индикатор загрузки
                    loadingSpinner.style.display = 'block';
                    quoteCard.style.opacity = '0.7';

                    const response = await fetch(`/get_quote?source=${source}`);
                    const data = await response.json();

                    // Обновить интерфейс
                    updateQuoteDisplay(data);

                } catch (error) {
                    console.error('Ошибка при получении цитаты:', error);
                    showError('Не удалось загрузить цитату. Пожалуйста, попробуйте еще раз.');
                } finally {
                    // Скрыть индикатор загрузки
                    loadingSpinner.style.display = 'none';
                    quoteCard.style.opacity = '1';
                }
            }

            // Функция для обновления отображения цитаты
            function updateQuoteDisplay(data) {
                currentQuote = data.quote;
                currentAuthor = data.author;

                quoteText.textContent = `"${currentQuote}"`;
                quoteAuthor.textContent = `— ${currentAuthor}`;

                if (data.category) {
                    quoteCategory.textContent = data.category;
                    quoteCategory.style.display = 'inline-block';
                } else {
                    quoteCategory.style.display = 'none';
                }

                if (data.source) {
                    quoteSource.textContent = `Источник: ${data.source}`;
                }

                // Обработка тегов
                if (data.tags && data.tags.length > 0) {
                    quoteTags.innerHTML = data.tags.map(tag =>
                        `<span class="badge bg-light text-dark me-1">${tag}</span>`
                    ).join('');
                } else {
                    quoteTags.innerHTML = '';
                }

                // Анимация
                quoteCard.classList.remove('fade-in');
                void quoteCard.offsetWidth; // Сброс анимации
                quoteCard.classList.add('fade-in');
            }

            // Функция для отображения ошибки
            function showError(message) {
                quoteText.textContent = message;
                quoteAuthor.textContent = '';
                quoteCategory.style.display = 'none';
                quoteSource.textContent = '';
                quoteTags.innerHTML = '';
            }

            // Функция для копирования цитаты в буфер обмена
            async function copyQuoteToClipboard() {
                const textToCopy = `${currentQuote} — ${currentAuthor}`;

                try {
                    await navigator.clipboard.writeText(textToCopy);

                    // Визуальная обратная связь
                    const originalText = copyQuoteBtn.innerHTML;
                    copyQuoteBtn.innerHTML = '<i class="fas fa-check"></i>';
                    copyQuoteBtn.classList.remove('btn-outline-secondary');
                    copyQuoteBtn.classList.add('btn-success');

                    setTimeout(() => {
                        copyQuoteBtn.innerHTML = originalText;
                        copyQuoteBtn.classList.remove('btn-success');
                        copyQuoteBtn.classList.add('btn-outline-secondary');
                    }, 2000);
                } catch (err) {
                    console.error('Ошибка при копировании:', err);
                    alert('Не удалось скопировать цитату. Пожалуйста, скопируйте ее вручную.');
                }
            }

            // Функция для публикации в Twitter
            function shareOnTwitter() {
                const tweetText = `"${currentQuote}" — ${currentAuthor}`;
                const tweetUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}`;
                window.open(tweetUrl, '_blank');
            }

            // Обработчики событий
            newQuoteBtn.addEventListener('click', () => {
                fetchQuote(currentSource);
            });

            copyQuoteBtn.addEventListener('click', copyQuoteToClipboard);

            shareTwitterBtn.addEventListener('click', shareOnTwitter);

            apiButtons.forEach(button => {
                button.addEventListener('click', function() {
                    currentSource = this.dataset.source;
                    updateActiveApiButton(currentSource);
                    fetchQuote(currentSource);
                });
            });

            // Загрузить первую цитату при загрузке страницы
            fetchQuote(currentSource);

            // Добавить поддержку клавиатуры
            document.addEventListener('keydown', (event) => {
                if (event.code === 'Space' || event.code === 'Enter') {
                    event.preventDefault();
                    fetchQuote(currentSource);
                }

                if (event.code === 'KeyC' && (event.ctrlKey || event.metaKey)) {
                    event.preventDefault();
                    copyQuoteToClipboard();
                }
            });
        });
    </script>
</body>
</html>